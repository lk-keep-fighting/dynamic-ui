import { BusinessAppRuntimePayload } from "@/lib/schema";

export const salesConsoleRuntime: BusinessAppRuntimePayload = {
  schema: {
    id: "sales-console",
    name: "销售订单智能中台",
    description: "基于AI动态生成的销售订单管理工作台",
    entities: [
      {
        id: "orders",
        name: "orders",
        label: "销售订单",
        description: "用于管理销售订单、跟踪状态与负责同事。",
        fields: [
          { name: "id", label: "订单号", type: "string", isPrimary: true, required: true, isIdentifier: true },
          { name: "customerName", label: "客户名称", type: "string", required: true, isSearchable: true },
          {
            name: "status",
            label: "订单状态",
            type: "status",
            description: "支持线索、洽谈、赢单、输单等典型状态。",
            enumValues: [
              { label: "线索", value: "lead" },
              { label: "洽谈中", value: "negotiation" },
              { label: "赢单", value: "won" },
              { label: "输单", value: "lost" },
              { label: "流失", value: "dropped" },
            ],
          },
          {
            name: "orderValue",
            label: "订单金额",
            type: "currency",
            required: true,
            isMetric: true,
            description: "@default:0",
          },
          {
            name: "probability",
            label: "成交概率",
            type: "percentage",
            description: "AI预估的成交概率",
            isMetric: true,
          },
          { name: "salesOwner", label: "负责人", type: "string", description: "负责跟进订单的销售" },
          { name: "createdAt", label: "创建时间", type: "datetime" },
          { name: "expectedClose", label: "预计成交", type: "date" },
          { name: "industry", label: "行业", type: "enum", enumValues: [
            { label: "制造", value: "manufacturing" },
            { label: "互联网", value: "internet" },
            { label: "能源", value: "energy" },
            { label: "零售", value: "retail" },
          ] },
          { name: "note", label: "备注", type: "text", componentHint: "textarea" },
          {
            name: "timeline",
            label: "时间线",
            type: "text",
            description: "存储和订单相关的业务节点，供时间线视图使用。",
          },
        ],
        sampleData: [
          {
            id: "SO-202401",
            customerName: "蓝海制造",
            status: "negotiation",
            orderValue: 380000,
            probability: 65,
            salesOwner: "刘洋",
            createdAt: "2024-03-01T09:30:00Z",
            expectedClose: "2024-04-15",
            industry: "manufacturing",
            note: "重点客户，需商务总监参与谈判",
            timeline: [
              {
                id: "1",
                label: "创建订单",
                description: "销售刘洋创建了订单，来源为官网线索。",
                timestamp: "2024-03-01T09:30:00Z",
                actor: "刘洋",
                status: "线索",
              },
              {
                id: "2",
                label: "完成需求调研",
                description: "售前完成调研，客户需要MES系统接入。",
                timestamp: "2024-03-05T14:20:00Z",
                actor: "王琪",
                status: "洽谈中",
              },
              {
                id: "3",
                label: "提交商务方案",
                description: "商务总监确认方案，价值38万人民币。",
                timestamp: "2024-03-10T10:00:00Z",
                actor: "陈璐",
                status: "洽谈中",
              },
            ],
          },
          {
            id: "SO-202402",
            customerName: "木星能源",
            status: "won",
            orderValue: 560000,
            probability: 92,
            salesOwner: "张伟",
            createdAt: "2024-02-20T08:15:00Z",
            expectedClose: "2024-02-28",
            industry: "energy",
            note: "签约完成，等待实施排期",
          },
          {
            id: "SO-202403",
            customerName: "未来零售",
            status: "lead",
            orderValue: 120000,
            probability: 35,
            salesOwner: "杨阳",
            createdAt: "2024-03-12T11:00:00Z",
            expectedClose: "2024-05-05",
            industry: "retail",
            note: "客户有预算限制，需要灵活付款方案",
          },
          {
            id: "SO-202404",
            customerName: "星辰互联网",
            status: "negotiation",
            orderValue: 450000,
            probability: 58,
            salesOwner: "王琪",
            createdAt: "2024-03-08T13:45:00Z",
            expectedClose: "2024-04-30",
            industry: "internet",
            note: "正在确认技术集成方案",
          },
          {
            id: "SO-202405",
            customerName: "启航制造",
            status: "lost",
            orderValue: 210000,
            probability: 0,
            salesOwner: "刘洋",
            createdAt: "2024-02-28T10:30:00Z",
            expectedClose: "2024-03-20",
            industry: "manufacturing",
            note: "客户选择竞争对手方案",
          },
        ],
      },
    ],
    operations: [
      {
        id: "create-order",
        name: "create-order",
        label: "新建销售订单",
        description: "收集基础信息并提交给订单创建接口。",
        targetEntity: "orders",
        kind: "create",
        method: "POST",
        endpoint: "/api/orders",
        parameters: [
          { name: "customerName", label: "客户名称", type: "string", required: true },
          {
            name: "status",
            label: "订单状态",
            type: "status",
            required: true,
            enumValues: [
              { label: "线索", value: "lead" },
              { label: "洽谈中", value: "negotiation" },
              { label: "赢单", value: "won" },
              { label: "输单", value: "lost" },
            ],
          },
          { name: "orderValue", label: "订单金额", type: "currency", required: true },
          { name: "probability", label: "成交概率", type: "percentage" },
          { name: "salesOwner", label: "负责人", type: "string", required: true },
          { name: "expectedClose", label: "预计成交时间", type: "date" },
          { name: "note", label: "备注", type: "text" },
        ],
        ui: {
          variant: "sheet",
          triggerLabel: "新建订单",
        },
      },
      {
        id: "update-status",
        name: "update-status",
        label: "更新订单状态",
        description: "通过API更新指定订单的业务状态。",
        targetEntity: "orders",
        kind: "update",
        method: "PATCH",
        endpoint: "/api/orders/status",
        parameters: [
          { name: "id", label: "订单号", type: "string", required: true },
          {
            name: "status",
            label: "新的状态",
            type: "status",
            required: true,
            enumValues: [
              { label: "线索", value: "lead" },
              { label: "洽谈中", value: "negotiation" },
              { label: "赢单", value: "won" },
              { label: "输单", value: "lost" },
              { label: "流失", value: "dropped" },
            ],
          },
          { name: "note", label: "状态备注", type: "text" },
        ],
        ui: {
          variant: "dialog",
          triggerLabel: "更新状态",
        },
      },
      {
        id: "assign-owner",
        name: "assign-owner",
        label: "重新指派负责人",
        targetEntity: "orders",
        kind: "update",
        method: "PATCH",
        endpoint: "/api/orders/assign",
        parameters: [
          { name: "id", label: "订单号", type: "string", required: true },
          { name: "salesOwner", label: "新的负责人", type: "string", required: true },
        ],
        ui: {
          variant: "dialog",
          triggerLabel: "重新指派",
        },
      },
      {
        id: "cancel-order",
        name: "cancel-order",
        label: "取消订单",
        description: "标记订单为输单并记录原因。",
        targetEntity: "orders",
        kind: "delete",
        method: "DELETE",
        endpoint: "/api/orders",
        parameters: [
          { name: "id", label: "订单号", type: "string", required: true },
          { name: "reason", label: "原因说明", type: "text" },
        ],
        ui: {
          variant: "dialog",
          triggerLabel: "取消订单",
        },
      },
    ],
    patterns: [
      {
        id: "orders-collection",
        name: "订单工作台",
        description: "聚合订单列表、指标、操作的综合工作台。",
        type: "collection-hub",
        entity: "orders",
        operations: ["create-order", "update-status", "assign-owner", "cancel-order"],
        features: {
          quickStats: true,
          quickFilters: true,
        },
      },
      {
        id: "orders-detail",
        name: "订单详情分析",
        description: "查看订单详情及时间线，辅助分析进展。",
        type: "detail-dashboard",
        entity: "orders",
        operations: ["update-status", "assign-owner"],
      },
      {
        id: "orders-analytics",
        name: "订单指标看板",
        description: "从金额与概率角度分析整体销售业绩。",
        type: "analytics-summary",
        entity: "orders",
      },
    ],
  },
};

export const inventoryConsoleRuntime: BusinessAppRuntimePayload = {
  schema: {
    id: "inventory-console",
    name: "仓储库存一体化面板",
    description: "关注库存水位、补货操作、调拨流转的综合面板",
    entities: [
      {
        id: "inventory",
        name: "inventory",
        label: "库存记录",
        description: "仓库库存与补货需求，适合供应链场景。",
        fields: [
          { name: "sku", label: "SKU", type: "string", isPrimary: true, required: true },
          { name: "productName", label: "商品名称", type: "string", required: true },
          { name: "warehouse", label: "仓库", type: "string" },
          { name: "category", label: "品类", type: "enum", enumValues: [
            { label: "原材料", value: "raw" },
            { label: "成品", value: "finish" },
            { label: "备品", value: "spare" },
          ] },
          { name: "stockOnHand", label: "现有库存", type: "integer", isMetric: true },
          { name: "safetyStock", label: "安全库存", type: "integer", isMetric: true },
          { name: "inbound", label: "在途入库", type: "integer" },
          { name: "outbound", label: "待出库", type: "integer" },
          { name: "lastInbound", label: "最近入库时间", type: "datetime" },
          { name: "owner", label: "责任人", type: "string" },
        ],
        sampleData: [
          {
            sku: "SKU-1001",
            productName: "工业轴承",
            warehouse: "华东仓",
            category: "raw",
            stockOnHand: 320,
            safetyStock: 200,
            inbound: 80,
            outbound: 40,
            lastInbound: "2024-03-14T08:30:00Z",
            owner: "李倩",
          },
          {
            sku: "SKU-1002",
            productName: "装配线主板",
            warehouse: "华北仓",
            category: "finish",
            stockOnHand: 90,
            safetyStock: 150,
            inbound: 120,
            outbound: 60,
            lastInbound: "2024-03-11T10:00:00Z",
            owner: "陈波",
          },
          {
            sku: "SKU-1003",
            productName: "维护备件套装",
            warehouse: "华东仓",
            category: "spare",
            stockOnHand: 45,
            safetyStock: 60,
            inbound: 30,
            outbound: 10,
            lastInbound: "2024-03-10T09:00:00Z",
            owner: "王凯",
          },
        ],
      },
    ],
    operations: [
      {
        id: "replenish-stock",
        name: "replenish-stock",
        label: "创建补货计划",
        targetEntity: "inventory",
        kind: "create",
        method: "POST",
        endpoint: "/api/inventory/replenish",
        parameters: [
          { name: "sku", label: "SKU", type: "string", required: true },
          { name: "quantity", label: "补货数量", type: "integer", required: true },
          { name: "expectedDate", label: "预计到货", type: "date" },
          { name: "note", label: "备注", type: "text" },
        ],
        ui: {
          variant: "sheet",
          triggerLabel: "创建补货",
        },
      },
      {
        id: "transfer-stock",
        name: "transfer-stock",
        label: "库存调拨",
        targetEntity: "inventory",
        kind: "action",
        method: "POST",
        endpoint: "/api/inventory/transfer",
        parameters: [
          { name: "sku", label: "SKU", type: "string", required: true },
          { name: "fromWarehouse", label: "调出仓库", type: "string", required: true },
          { name: "toWarehouse", label: "调入仓库", type: "string", required: true },
          { name: "quantity", label: "调拨数量", type: "integer", required: true },
        ],
        ui: {
          variant: "dialog",
          triggerLabel: "发起调拨",
        },
      },
      {
        id: "adjust-safety",
        name: "adjust-safety",
        label: "调整安全库存",
        targetEntity: "inventory",
        kind: "update",
        method: "PATCH",
        endpoint: "/api/inventory/safety",
        parameters: [
          { name: "sku", label: "SKU", type: "string", required: true },
          { name: "safetyStock", label: "新的安全库存", type: "integer", required: true },
        ],
        ui: {
          variant: "dialog",
          triggerLabel: "调整安全库存",
        },
      },
    ],
    patterns: [
      {
        id: "inventory-dashboard",
        name: "库存总览",
        description: "展示库存水位与预警信号。",
        type: "collection-hub",
        entity: "inventory",
        operations: ["replenish-stock", "transfer-stock", "adjust-safety"],
        features: {
          quickStats: true,
        },
      },
      {
        id: "inventory-analysis",
        name: "库存预测分析",
        description: "聚焦库存指标，辅助采购预测。",
        type: "analytics-summary",
        entity: "inventory",
      },
    ],
  },
};

export const hrPerformanceRuntime: BusinessAppRuntimePayload = {
  schema: {
    id: "hr-performance",
    name: "员工绩效与目标面板",
    description: "人力资源部门使用的OKR与绩效追踪界面",
    entities: [
      {
        id: "employees",
        name: "employees",
        label: "员工绩效",
        description: "按季度跟踪员工绩效指标与反馈。",
        fields: [
          { name: "employeeId", label: "员工ID", type: "string", isPrimary: true, required: true },
          { name: "name", label: "姓名", type: "string", required: true },
          {
            name: "department",
            label: "部门",
            type: "enum",
            enumValues: [
              { label: "研发", value: "rd" },
              { label: "销售", value: "sales" },
              { label: "市场", value: "marketing" },
              { label: "运营", value: "ops" },
            ],
          },
          { name: "okrCompletion", label: "OKR完成度", type: "percentage", isMetric: true },
          { name: "rating", label: "绩效评级", type: "enum", enumValues: [
            { label: "A", value: "A" },
            { label: "B", value: "B" },
            { label: "C", value: "C" },
          ] },
          { name: "lastReview", label: "上次评估", type: "date" },
          { name: "manager", label: "直属上级", type: "string" },
          { name: "improvementPlan", label: "改进计划", type: "text", componentHint: "textarea" },
        ],
        sampleData: [
          {
            employeeId: "E-1001",
            name: "李敏",
            department: "rd",
            okrCompletion: 86,
            rating: "A",
            lastReview: "2024-03-05",
            manager: "王磊",
            improvementPlan: "保持技术分享节奏，组内知识库按月更新。",
          },
          {
            employeeId: "E-1002",
            name: "张强",
            department: "sales",
            okrCompletion: 72,
            rating: "B",
            lastReview: "2024-03-10",
            manager: "刘珊",
            improvementPlan: "重点关注华南大客户拓展，月内完成两次拜访。",
          },
          {
            employeeId: "E-1003",
            name: "王婷",
            department: "ops",
            okrCompletion: 64,
            rating: "B",
            lastReview: "2024-03-02",
            manager: "周毅",
            improvementPlan: "梳理客服SOP，降低新手培训周期。",
          },
        ],
      },
    ],
    operations: [
      {
        id: "update-review",
        name: "update-review",
        label: "更新绩效评估",
        targetEntity: "employees",
        kind: "update",
        method: "PATCH",
        endpoint: "/api/hr/review",
        parameters: [
          { name: "employeeId", label: "员工ID", type: "string", required: true },
          { name: "rating", label: "绩效评级", type: "enum", enumValues: [
            { label: "A", value: "A" },
            { label: "B", value: "B" },
            { label: "C", value: "C" },
          ], required: true },
          { name: "okrCompletion", label: "OKR完成度", type: "percentage" },
          { name: "comment", label: "评语", type: "text" },
        ],
        ui: {
          variant: "dialog",
          triggerLabel: "更新评估",
        },
      },
      {
        id: "create-plan",
        name: "create-plan",
        label: "制定改进计划",
        targetEntity: "employees",
        kind: "create",
        method: "POST",
        endpoint: "/api/hr/plan",
        parameters: [
          { name: "employeeId", label: "员工ID", type: "string", required: true },
          { name: "improvementPlan", label: "改进计划", type: "text", required: true },
          { name: "manager", label: "负责人", type: "string" },
        ],
        ui: {
          variant: "sheet",
          triggerLabel: "制定改进计划",
        },
      },
    ],
    patterns: [
      {
        id: "employee-overview",
        name: "绩效总览",
        description: "查看全员绩效、分布和重点关注对象。",
        type: "collection-hub",
        entity: "employees",
        operations: ["update-review", "create-plan"],
        features: {
          quickStats: true,
        },
      },
      {
        id: "employee-detail",
        name: "个体深度洞察",
        description: "针对单个员工的绩效与计划进行分析。",
        type: "detail-dashboard",
        entity: "employees",
        operations: ["update-review"],
      },
    ],
  },
};
